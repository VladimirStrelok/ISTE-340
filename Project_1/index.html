<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Project 1</title>
  <link rel="stylesheet" href="css/styles.css">
  <!--[if lt IE 9]>
  <script>
    document.createElement('nav');
    document.createElement('header');
    document.createElement('main');
  </script>
  <![endif]-->
  <!--[if lt IE 8]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/json3/3.3.2/json3.min.js"></script>
  <![endif]-->
  <!--[if lt IE 7]>
    <script>
      window.location = 'http://whatbrowser.org/';
    </script>
  <![endif]-->

  <script>

  //fixing IE8 isue with Object.keys
  if (!Object.keys) {
    Object.keys = function(obj) {
      var keys = [];

      for (var i in obj) {
        if (obj.hasOwnProperty(i)) {
          keys.push(i);
        }
      }

      return keys;
    };
  }

  // variables
  var jsonData, activeDatasetName, activeDataset;

  activeDatasetName = 'football';

  // functions
  var getData, setUp, createSelect, selectChange, generateNav,anchorClick;

  getData = function(){
    var request, response;
    request = new XMLHttpRequest();
    request.open( "GET", "./data.json", true );
    request.setRequestHeader("Content-type", "application/json");

    request.onreadystatechange = function(){
      if( request.readyState == 4 && request.status == 200 ){
        jsonData = JSON.parse( request.responseText );
        generateNav();
        setUp();
      }
    }
    request.send();
  }
  setUp = function(){
    while(document.forms[0].firstChild){
      document.forms[0].removeChild(document.forms[0].firstChild);
    }
    activeDataset = jsonData[activeDatasetName];
    document.getElementById(activeDatasetName).setAttribute('class','active')
    var initial = createSelect(activeDataset)
    document.forms[0].appendChild(initial);
    initial.style.opacity = 0;
    window.getComputedStyle(initial).opacity;
    // Fade it in.
    initial.style.opacity = 1;

    var category = document.getElementById('category');
    category.textContent = activeDataset.value;
  }
  createSelect = function(data){
    if(data.children){
      var element=document.createElement("select");
      var firstChild =  document.createElement("option");
      var firstChildText = document.createTextNode("Choose an Option");
      firstChild.appendChild(firstChildText);
      firstChild.setAttribute("disabled", true)
      firstChild.setAttribute("selected", true)
      firstChild.setAttribute("hidden", true)
      element.appendChild(firstChild);
      var keys = Object.keys(data.children);
      for(var i=0, l=keys.length; i < l; i++){
        var key = keys[i];
        var child = document.createElement('option');
        var text = document.createTextNode(data.children[key].value);
        child.setAttribute('value',key)
        child.appendChild(text);
        element.appendChild(child);
      }
      element.setAttribute('onchange','selectChange(this)');
      return element;
    }

  }
  selectChange = function(cur){;
    while(cur.nextSibling){
      cur.parentNode.removeChild(cur.nextSibling)
    }
    var currentNode = cur.parentNode.firstChild;
    var currentData = activeDataset;
    do{
      currentData = currentData.children[currentNode.value];
    } while(currentNode = currentNode.nextSibling);
    var nextChild = createSelect(currentData);
    if(nextChild){
      document.forms[0].appendChild(nextChild);
      nextChild.style.opacity = 0;
      window.getComputedStyle(nextChild).opacity;
      // Fade it in.
      nextChild.style.opacity = 1;
    }
  }
  generateNav = function(){
    var keys = Object.keys(jsonData);
    var nav = document.getElementById("nav");
    for(var i=0, l=keys.length; i < l; i++){
      var key = keys[i];
      var anchor = document.createElement('a');
      var anchorText = document.createTextNode(jsonData[key].value);
      anchor.appendChild(anchorText);
      anchor.setAttribute("id",key);
      anchor.setAttribute("onclick","anchorClick(this)");
      nav.appendChild(anchor);
    }
  }
  anchorClick = function(anchor){
    if(anchor.id != activeDatasetName){
      var nav = document.getElementById("nav");
      var anchors = nav.getElementsByTagName('a');
      for(var i = 0, l=anchors.length; i < l; i++){
        anchors[i].setAttribute('class','');
      }
      activeDatasetName = anchor.id;
      setUp();
    }
  }
  getData();
  </script>
</head>
<body>
  <header>
    <nav id='nav'>
      <span>Data Sets</span>
    </nav>
  </header>
  <main>
    <h1 id='category'></h1>
    <form>
    </form>
    <button onclick="setUp(activeDatasetName)">Reset</button>
    <button>Print</button>
    <button>Save</button>
  </main>
</body>
</html>
